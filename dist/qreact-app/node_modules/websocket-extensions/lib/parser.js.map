{"version":3,"sources":["../../../../../qreact-app/node_modules/websocket-extensions/lib/parser.js"],"names":["TOKEN","NOTOKEN","QUOTED","PARAM","RegExp","source","EXT","EXT_LIST","NUMBER","Parser","parseHeader","header","offers","Offers","undefined","test","SyntaxError","values","match","forEach","value","params","name","shift","offer","param","args","key","data","replace","parseFloat","hasOwnProperty","concat","push","serializeParams","print","Array","v","join","_byName","_inOrder","prototype","eachOffer","callback","context","list","i","n","length","call","byName","toArray","slice","module","exports"],"mappings":"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","file":"parser.js","sourcesContent":["'use strict';\n\nvar TOKEN    = /([!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z]+)/,\n    NOTOKEN  = /([^!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z])/g,\n    QUOTED   = /\"((?:\\\\[\\x00-\\x7f]|[^\\x00-\\x08\\x0a-\\x1f\\x7f\"])*)\"/,\n    PARAM    = new RegExp(TOKEN.source + '(?:=(?:' + TOKEN.source + '|' + QUOTED.source + '))?'),\n    EXT      = new RegExp(TOKEN.source + '(?: *; *' + PARAM.source + ')*', 'g'),\n    EXT_LIST = new RegExp('^' + EXT.source + '(?: *, *' + EXT.source + ')*$'),\n    NUMBER   = /^-?(0|[1-9][0-9]*)(\\.[0-9]+)?$/;\n\nvar Parser = {\n  parseHeader: function(header) {\n    var offers = new Offers();\n    if (header === '' || header === undefined) return offers;\n\n    if (!EXT_LIST.test(header))\n      throw new SyntaxError('Invalid Sec-WebSocket-Extensions header: ' + header);\n\n    var values = header.match(EXT);\n\n    values.forEach(function(value) {\n      var params = value.match(new RegExp(PARAM.source, 'g')),\n          name   = params.shift(),\n          offer  = {};\n\n      params.forEach(function(param) {\n        var args = param.match(PARAM), key = args[1], data;\n\n        if (args[2] !== undefined) {\n          data = args[2];\n        } else if (args[3] !== undefined) {\n          data = args[3].replace(/\\\\/g, '');\n        } else {\n          data = true;\n        }\n        if (NUMBER.test(data)) data = parseFloat(data);\n\n        if (offer.hasOwnProperty(key)) {\n          offer[key] = [].concat(offer[key]);\n          offer[key].push(data);\n        } else {\n          offer[key] = data;\n        }\n      }, this);\n      offers.push(name, offer);\n    }, this);\n\n    return offers;\n  },\n\n  serializeParams: function(name, params) {\n    var values = [];\n\n    var print = function(key, value) {\n      if (value instanceof Array) {\n        value.forEach(function(v) { print(key, v) });\n      } else if (value === true) {\n        values.push(key);\n      } else if (typeof value === 'number') {\n        values.push(key + '=' + value);\n      } else if (NOTOKEN.test(value)) {\n        values.push(key + '=\"' + value.replace(/\"/g, '\\\\\"') + '\"');\n      } else {\n        values.push(key + '=' + value);\n      }\n    };\n\n    for (var key in params) print(key, params[key]);\n\n    return [name].concat(values).join('; ');\n  }\n};\n\nvar Offers = function() {\n  this._byName  = {};\n  this._inOrder = [];\n};\n\nOffers.prototype.push = function(name, params) {\n  this._byName[name] = this._byName[name] || [];\n  this._byName[name].push(params);\n  this._inOrder.push({name: name, params: params});\n};\n\nOffers.prototype.eachOffer = function(callback, context) {\n  var list = this._inOrder;\n  for (var i = 0, n = list.length; i < n; i++)\n    callback.call(context, list[i].name, list[i].params);\n};\n\nOffers.prototype.byName = function(name) {\n  return this._byName[name] || [];\n};\n\nOffers.prototype.toArray = function() {\n  return this._inOrder.slice();\n};\n\nmodule.exports = Parser;\n"]}