{"version":3,"sources":["../../../../../../qreact-app/node_modules/websocket-extensions/lib/pipeline/ring_buffer.js"],"names":["RingBuffer","bufferSize","_buffer","Array","_bufferSize","_ringOffset","_ringSize","_head","_tail","length","prototype","push","value","expandBuffer","expandRing","concat","peek","shift","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,aAAa,SAAbA,UAAa,CAASC,UAAT,EAAqB;AACpC,OAAKC,OAAL,GAAmB,IAAIC,KAAJ,CAAUF,UAAV,CAAnB;AACA,OAAKG,WAAL,GAAmBH,UAAnB;AACA,OAAKI,WAAL,GAAmB,CAAnB;AACA,OAAKC,SAAL,GAAmBL,UAAnB;AACA,OAAKM,KAAL,GAAmB,CAAnB;AACA,OAAKC,KAAL,GAAmB,CAAnB;AACA,OAAKC,MAAL,GAAmB,CAAnB;AACD,CARD;;AAUAT,WAAWU,SAAX,CAAqBC,IAArB,GAA4B,UAASC,KAAT,EAAgB;AAC1C,MAAIC,eAAe,KAAnB;AAAA,MACIC,aAAe,KADnB;;AAGA,MAAI,KAAKR,SAAL,GAAiB,KAAKF,WAA1B,EAAuC;AACrCS,mBAAgB,KAAKL,KAAL,KAAe,CAA/B;AACD,GAFD,MAEO,IAAI,KAAKH,WAAL,KAAqB,KAAKC,SAA9B,EAAyC;AAC9CO,mBAAe,IAAf;AACAC,iBAAgB,KAAKN,KAAL,KAAe,CAA/B;AACD;;AAED,MAAIK,YAAJ,EAAkB;AAChB,SAAKL,KAAL,GAAmB,KAAKJ,WAAxB;AACA,SAAKF,OAAL,GAAmB,KAAKA,OAAL,CAAaa,MAAb,CAAoB,IAAIZ,KAAJ,CAAU,KAAKC,WAAf,CAApB,CAAnB;AACA,SAAKA,WAAL,GAAmB,KAAKF,OAAL,CAAaO,MAAhC;;AAEA,QAAIK,UAAJ,EACE,KAAKR,SAAL,GAAiB,KAAKF,WAAtB;AACH;;AAED,OAAKF,OAAL,CAAa,KAAKM,KAAlB,IAA2BI,KAA3B;AACA,OAAKH,MAAL,IAAe,CAAf;AACA,MAAI,KAAKD,KAAL,GAAa,KAAKF,SAAtB,EAAiC,KAAKD,WAAL,IAAoB,CAApB;AACjC,OAAKG,KAAL,GAAa,CAAC,KAAKA,KAAL,GAAa,CAAd,IAAmB,KAAKJ,WAArC;AACD,CAxBD;;AA0BAJ,WAAWU,SAAX,CAAqBM,IAArB,GAA4B,YAAW;AACrC,MAAI,KAAKP,MAAL,KAAgB,CAApB,EAAuB,OAAO,KAAK,CAAZ;AACvB,SAAO,KAAKP,OAAL,CAAa,KAAKK,KAAlB,CAAP;AACD,CAHD;;AAKAP,WAAWU,SAAX,CAAqBO,KAArB,GAA6B,YAAW;AACtC,MAAI,KAAKR,MAAL,KAAgB,CAApB,EAAuB,OAAO,KAAK,CAAZ;;AAEvB,MAAIG,QAAQ,KAAKV,OAAL,CAAa,KAAKK,KAAlB,CAAZ;AACA,OAAKL,OAAL,CAAa,KAAKK,KAAlB,IAA2B,KAAK,CAAhC;AACA,OAAKE,MAAL,IAAe,CAAf;AACA,OAAKJ,WAAL,IAAoB,CAApB;;AAEA,MAAI,KAAKA,WAAL,KAAqB,CAArB,IAA0B,KAAKI,MAAL,GAAc,CAA5C,EAA+C;AAC7C,SAAKF,KAAL,GAAmB,KAAKD,SAAxB;AACA,SAAKD,WAAL,GAAmB,KAAKI,MAAxB;AACA,SAAKH,SAAL,GAAmB,KAAKF,WAAxB;AACD,GAJD,MAIO;AACL,SAAKG,KAAL,GAAa,CAAC,KAAKA,KAAL,GAAa,CAAd,IAAmB,KAAKD,SAArC;AACD;AACD,SAAOM,KAAP;AACD,CAhBD;;AAkBAM,OAAOC,OAAP,GAAiBnB,UAAjB","file":"ring_buffer.js","sourcesContent":["'use strict';\n\nvar RingBuffer = function(bufferSize) {\n  this._buffer     = new Array(bufferSize);\n  this._bufferSize = bufferSize;\n  this._ringOffset = 0;\n  this._ringSize   = bufferSize;\n  this._head       = 0;\n  this._tail       = 0;\n  this.length      = 0;\n};\n\nRingBuffer.prototype.push = function(value) {\n  var expandBuffer = false,\n      expandRing   = false;\n\n  if (this._ringSize < this._bufferSize) {\n    expandBuffer = (this._tail === 0);\n  } else if (this._ringOffset === this._ringSize) {\n    expandBuffer = true;\n    expandRing   = (this._tail === 0);\n  }\n\n  if (expandBuffer) {\n    this._tail       = this._bufferSize;\n    this._buffer     = this._buffer.concat(new Array(this._bufferSize));\n    this._bufferSize = this._buffer.length;\n\n    if (expandRing)\n      this._ringSize = this._bufferSize;\n  }\n\n  this._buffer[this._tail] = value;\n  this.length += 1;\n  if (this._tail < this._ringSize) this._ringOffset += 1;\n  this._tail = (this._tail + 1) % this._bufferSize;\n};\n\nRingBuffer.prototype.peek = function() {\n  if (this.length === 0) return void 0;\n  return this._buffer[this._head];\n};\n\nRingBuffer.prototype.shift = function() {\n  if (this.length === 0) return void 0;\n\n  var value = this._buffer[this._head];\n  this._buffer[this._head] = void 0;\n  this.length -= 1;\n  this._ringOffset -= 1;\n\n  if (this._ringOffset === 0 && this.length > 0) {\n    this._head       = this._ringSize;\n    this._ringOffset = this.length;\n    this._ringSize   = this._bufferSize;\n  } else {\n    this._head = (this._head + 1) % this._ringSize;\n  }\n  return value;\n};\n\nmodule.exports = RingBuffer;\n"]}