{"version":3,"sources":["../../../../../../qreact-app/node_modules/websocket-extensions/lib/pipeline/pledge.js"],"names":["RingBuffer","require","Pledge","_complete","_callbacks","QUEUE_SIZE","all","list","pledge","pending","length","n","done","then","prototype","callback","push","callbacks","shift","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,aAAaC,QAAQ,eAAR,CAAjB;;AAEA,IAAIC,SAAS,SAATA,MAAS,GAAW;AACtB,OAAKC,SAAL,GAAkB,KAAlB;AACA,OAAKC,UAAL,GAAkB,IAAIJ,UAAJ,CAAeE,OAAOG,UAAtB,CAAlB;AACD,CAHD;;AAKAH,OAAOG,UAAP,GAAoB,CAApB;;AAEAH,OAAOI,GAAP,GAAa,UAASC,IAAT,EAAe;AAC1B,MAAIC,SAAU,IAAIN,MAAJ,EAAd;AAAA,MACIO,UAAUF,KAAKG,MADnB;AAAA,MAEIC,IAAUF,OAFd;;AAIA,MAAIA,YAAY,CAAhB,EAAmBD,OAAOI,IAAP;;AAEnB,SAAOD,GAAP;AAAYJ,SAAKI,CAAL,EAAQE,IAAR,CAAa,YAAW;AAClCJ,iBAAW,CAAX;AACA,UAAIA,YAAY,CAAhB,EAAmBD,OAAOI,IAAP;AACpB,KAHW;AAAZ,GAIA,OAAOJ,MAAP;AACD,CAZD;;AAcAN,OAAOY,SAAP,CAAiBD,IAAjB,GAAwB,UAASE,QAAT,EAAmB;AACzC,MAAI,KAAKZ,SAAT,EAAoBY,WAApB,KACK,KAAKX,UAAL,CAAgBY,IAAhB,CAAqBD,QAArB;AACN,CAHD;;AAKAb,OAAOY,SAAP,CAAiBF,IAAjB,GAAwB,YAAW;AACjC,OAAKT,SAAL,GAAiB,IAAjB;AACA,MAAIc,YAAY,KAAKb,UAArB;AAAA,MAAiCW,QAAjC;AACA,SAAOA,WAAWE,UAAUC,KAAV,EAAlB;AAAqCH;AAArC;AACD,CAJD;;AAMAI,OAAOC,OAAP,GAAiBlB,MAAjB","file":"pledge.js","sourcesContent":["'use strict';\n\nvar RingBuffer = require('./ring_buffer');\n\nvar Pledge = function() {\n  this._complete  = false;\n  this._callbacks = new RingBuffer(Pledge.QUEUE_SIZE);\n};\n\nPledge.QUEUE_SIZE = 4;\n\nPledge.all = function(list) {\n  var pledge  = new Pledge(),\n      pending = list.length,\n      n       = pending;\n\n  if (pending === 0) pledge.done();\n\n  while (n--) list[n].then(function() {\n    pending -= 1;\n    if (pending === 0) pledge.done();\n  });\n  return pledge;\n};\n\nPledge.prototype.then = function(callback) {\n  if (this._complete) callback();\n  else this._callbacks.push(callback);\n};\n\nPledge.prototype.done = function() {\n  this._complete = true;\n  var callbacks = this._callbacks, callback;\n  while (callback = callbacks.shift()) callback();\n};\n\nmodule.exports = Pledge;\n"]}